

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>IQM_Vis.metrics.NLPD_torch.layers package &mdash; IQM-Vis 0.2 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/sg_gallery.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="IQM_Vis.metrics.NLPD_torch.utils package" href="IQM_Vis.metrics.NLPD_torch.utils.html" />
    <link rel="prev" title="IQM_Vis.metrics.NLPD_torch package" href="IQM_Vis.metrics.NLPD_torch.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> IQM-Vis
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">What is an IQM?:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="what-are-IQMs.html">IQMs</a></li>
</ul>
<p><span class="caption-text">About IQM-Vis:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">About IQM-Vis</a></li>
</ul>
<p><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<p><span class="caption-text">Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Tutorials.html">Tutorials</a></li>
</ul>
<p><span class="caption-text">Documentation:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="IQM_Vis.transformations.html">IQM_Vis.transformations package</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="IQM_Vis.metrics.html">IQM_Vis.metrics package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="IQM_Vis.metrics.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="IQM_Vis.metrics.NLPD_torch.html">IQM_Vis.metrics.NLPD_torch package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="IQM_Vis.metrics.NLPD_torch.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="IQM_Vis.metrics.NLPD_torch.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="IQM_Vis.metrics.NLPD_torch.html#module-IQM_Vis.metrics.NLPD_torch.pyramids">IQM_Vis.metrics.NLPD_torch.pyramids module</a></li>
<li class="toctree-l4"><a class="reference internal" href="IQM_Vis.metrics.NLPD_torch.html#module-IQM_Vis.metrics.NLPD_torch">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="IQM_Vis.metrics.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="IQM_Vis.metrics.html#module-IQM_Vis.metrics.IQMs">IQM_Vis.metrics.IQMs module</a></li>
<li class="toctree-l2"><a class="reference internal" href="IQM_Vis.metrics.html#module-IQM_Vis.metrics">Module contents</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">IQM-Vis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="IQM_Vis.metrics.html">IQM_Vis.metrics package</a> &raquo;</li>
        
          <li><a href="IQM_Vis.metrics.NLPD_torch.html">IQM_Vis.metrics.NLPD_torch package</a> &raquo;</li>
        
      <li>IQM_Vis.metrics.NLPD_torch.layers package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/IQM_Vis.metrics.NLPD_torch.layers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="iqm-vis-metrics-nlpd-torch-layers-package">
<h1>IQM_Vis.metrics.NLPD_torch.layers package<a class="headerlink" href="#iqm-vis-metrics-nlpd-torch-layers-package" title="Permalink to this headline">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation">
<span id="iqm-vis-metrics-nlpd-torch-layers-divisive-normalisation-module"></span><h2>IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation module<a class="headerlink" href="#module-IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">expert.layers.divisive_normalisation</span></code> module holds classes of
layers for a network that use divisive normalisation. This includes
generalised divisive normalisation.</p>
<dl class="py class">
<dt id="IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.</span></code><code class="sig-name descname"><span class="pre">GDN</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_channels</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">padding</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma_init</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reparam_offset</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">3.814697265625e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta_min</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_independently</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/IQM_Vis/metrics/NLPD_torch/layers/divisive_normalisation.html#GDN"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">torch.nn.modules.module.Module</span></code></p>
<p>Generalised Divisve Normalisation proposed in <a class="reference internal" href="#balle2015gdn" id="citation-reference-1"><span>[BALLE2015GDN]</span></a>.</p>
<p>The activation function this layer implements when kernel size is 1 is
given by:
.. math:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">sum_j</span><span class="p">(</span><span class="n">gamma</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>where <cite>i</cite> and <cite>j</cite> run over channels.</p>
<p>If the kernel_size is kept to the default value of 1, this represents the
true generalised divisve normalisation proposed in <a class="reference internal" href="#balle2015gdn" id="citation-reference-2"><span>[BALLE2015GDN]</span></a>. If the
kernel size is larger than 1, the convolution acts not only channel wise
but also acts spatially. This is called spatial generalised divisive
normalisation.</p>
<div role="list" class="citation-list">
<div class="citation" id="balle2015gdn" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>BALLE2015GDN<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#citation-reference-1">1</a>,<a role="doc-backlink" href="#citation-reference-2">2</a>)</span>
<p>Ballé, Johannes, et al. Density Modeling of Images Using
a Generalized Normalization Transformation. Nov. 2015. arxiv.org,
<a class="reference external" href="https://arxiv.org/abs/1511.06281v4">https://arxiv.org/abs/1511.06281v4</a>.</p>
</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_channels</strong> (<em>int</em>) – Number of channels that the input to this layer will have.</p></li>
<li><p><strong>kernel_size</strong> (<em>int</em><em>, </em><em>optional</em><em> (</em><em>default=1</em><em>)</em>) – Size of the kernel. A square kernel is always used and will have shape
[kernel_size, kernel_size]</p></li>
<li><p><strong>stride</strong> (<em>int</em><em>, </em><em>optional</em><em> (</em><em>default=1</em><em>)</em>) – The stride of the convolution in the forward pass.</p></li>
<li><p><strong>padding</strong> (<em>int</em><em>, </em><em>optional</em><em> (</em><em>default=0</em><em>)</em>) – The padding to be used in the convolution in the forward pass. In order
to get the output of the convolution to be the same size as the input,
to avoid having to interpolate, then the <code class="docutils literal notranslate"><span class="pre">padding</span></code> parameter should
be chosen carefully.</p></li>
<li><p><strong>gamma_init</strong> (<em>float</em><em>, </em><em>optional</em><em> (</em><em>default=0.1</em><em>)</em>) – The value that the gamma matrix will be initialised with, it will be
the identity multiplied by this value.</p></li>
<li><p><strong>reparam_offset</strong> (<em>float</em><em>, </em><em>optional</em><em> (</em><em>default=2*1e-18</em><em>)</em>) – </p></li>
<li><p><strong>beta_min</strong> (<em>float</em><em>, </em><em>optional</em><em> (</em><em>default=1e-6</em><em>)</em>) – The minimum value that the beta value can reach.</p></li>
<li><p><strong>apply_independently</strong> (<em>boolean</em><em>, </em><em>optional</em><em> (</em><em>default=False</em><em>)</em>) – A boolean that determines whether this operation is applied channel
wise or not. If not, then the divisive normalisation just divides each
channel by a learnable parameter, and they are treated independently.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>TypeError</strong> – <code class="docutils literal notranslate"><span class="pre">n_channels</span></code> parameter is not an integer larger than 0. <code class="docutils literal notranslate"><span class="pre">stride</span></code>
    parameter is not an integer larger than 0. <code class="docutils literal notranslate"><span class="pre">padding</span></code> parameter is not
    an integer larger or equal to 0. <code class="docutils literal notranslate"><span class="pre">gamma_init</span></code> parameter is not a
    positive float. <code class="docutils literal notranslate"><span class="pre">reparam_offset</span></code> parameter is not a positive float.
    <code class="docutils literal notranslate"><span class="pre">beta_min</span></code> parameter is not a positive float. <code class="docutils literal notranslate"><span class="pre">apply_independently</span></code>
    is not a boolean.</p>
</dd>
</dl>
<dl class="py attribute">
<dt id="IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.reparam_offset">
<code class="sig-name descname"><span class="pre">reparam_offset</span></code><a class="headerlink" href="#IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.reparam_offset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reparameterisation offset as to avoid gamma or beta going close to zero
and the gradients when backpropogating to approaching zero.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.beta_reparam">
<code class="sig-name descname"><span class="pre">beta_reparam</span></code><a class="headerlink" href="#IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.beta_reparam" title="Permalink to this definition">¶</a></dt>
<dd><p>Reparameterisation offset for the beta parameter specifically.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.groups">
<code class="sig-name descname"><span class="pre">groups</span></code><a class="headerlink" href="#IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.groups" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of groups to use in the convolution operation. If
<code class="docutils literal notranslate"><span class="pre">apply_independently</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then this should be 1, otherwise
equal to <code class="docutils literal notranslate"><span class="pre">n_channels</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.gamma">
<code class="sig-name descname"><span class="pre">gamma</span></code><a class="headerlink" href="#IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.gamma" title="Permalink to this definition">¶</a></dt>
<dd><p>The torch tensor for the weights to be used in the convolution
operation.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.beta">
<code class="sig-name descname"><span class="pre">beta</span></code><a class="headerlink" href="#IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.beta" title="Permalink to this definition">¶</a></dt>
<dd><p>The torch tensor for the bias to be used in the convoltuion operation.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.clamp_parameters">
<code class="sig-name descname"><span class="pre">clamp_parameters</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="reference internal" href="_modules/IQM_Vis/metrics/NLPD_torch/layers/divisive_normalisation.html#GDN.clamp_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.clamp_parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Clamps the gamma and beta parameters that are used in the convolution.</p>
<p>The gamma and beta parameters are clamped, ignoring the gradient of
the clamping, to the <code class="docutils literal notranslate"><span class="pre">reparam_offset</span></code> and <code class="docutils literal notranslate"><span class="pre">beta_reparam</span></code>
parameters.</p>
</dd></dl>

<dl class="py method">
<dt id="IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.forward">
<code class="sig-name descname"><span class="pre">forward</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">torch.Tensor</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">torch.Tensor</span><a class="reference internal" href="_modules/IQM_Vis/metrics/NLPD_torch/layers/divisive_normalisation.html#GDN.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward pass of the layer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>x</strong> (<em>torch.Tensor</em>) – The input to the layer. Must be of shape [batch_size, channels,
height, width].</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>TypeError:</strong> – Input parameter <code class="docutils literal notranslate"><span class="pre">x</span></code> is not of dtype torch.float.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>output</strong> – Output of the generalised divisive normalisation layer.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.training">
<code class="sig-name descname"><span class="pre">training</span></code><em class="property"><span class="pre">:</span> <span class="pre">bool</span></em><a class="headerlink" href="#IQM_Vis.metrics.NLPD_torch.layers.divisive_normalisation.GDN.training" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-IQM_Vis.metrics.NLPD_torch.layers">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-IQM_Vis.metrics.NLPD_torch.layers" title="Permalink to this headline">¶</a></h2>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="IQM_Vis.metrics.NLPD_torch.utils.html" class="btn btn-neutral float-right" title="IQM_Vis.metrics.NLPD_torch.utils package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="IQM_Vis.metrics.NLPD_torch.html" class="btn btn-neutral float-left" title="IQM_Vis.metrics.NLPD_torch package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2023, Matt Clifford.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>